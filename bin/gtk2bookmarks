#!/usr/bin/env ruby
require 'rubygems'
gem 'gtk2applib', '~> 7.1'
require 'gtk2applib'

include Gtk2AppLib
program = Program.new( {
        :name           => 'Ruby-Gnome Bookmarks',
        :tooltip        => 'Bookmarks',
	:icon_name	=> 'Bookmarks',
	:FILE		=> __FILE__,
	:lock		=> "Proceed anyways?",
	} )

require 'gtk2bookmarks'
data			= Gtk2Bookmarks::Data.load(Configuration::DATA_DUMP_FILE,true)
data.exclude_tags	= Configuration::EXCLUDE_TAGS
data.timeout		= Configuration::HTTP_TIMEOUT
data.max_list		= Configuration::MAX_LIST
data.min_list		= Configuration::MIN_LIST
data.attenuation	= Configuration::ATTENUATION
app			= Gtk2Bookmarks::App.new(data,program.dock_menu)
begin
  app.build_dock_menu
  about = {
	:authors	=> ['carlosjhr64@gmail.com'],
	:website	=> 'http://ruby-gnome-apps.blogspot.com',
	:website_label	=> 'Ruby-Gnome Apps',
	:license	=> 'GPL',
	:copyright	=> '2010-08-08 11:34:59',
	}
  program.window(about){|window| app.build_window(window) }
rescue Exception
  Gtk2AppLib.puts_bang!('Shutting down')
ensure
  begin
    data.dump(Configuration::DATA_DUMP_FILE)
    program.finalize
    app.thread_kill
  rescue Exception
    Gtk2AppLib.puts_bang!
  end
end
